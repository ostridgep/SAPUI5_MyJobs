<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Access-Control-Allow-Origin" content="*"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>MyJobs - Notifications</title>
<script src="resources/sap-ui-core.js" type="text/javascript"
	id="sap-ui-bootstrap" data-sap-ui-libs="sap.m,sap.ui.commons"
	data-sap-ui-theme="sap_bluecrystal">
	
</script>

<script src="myresources/js/buildDetails.js"></script>
<script src="myresources/js/html5sql.js"></script>  
<script src="myresources/js/bgsync.js"></script>
<script src="myresources/js/MyJobsDB.js"></script>
<script src="myresources/js/MyJobsUtils.js"></script>
<script type="text/javascript">
html5sql.openDatabase("com.pjo.myjobsbackfill","myjobsbackfill", 5*1024*1024);	
var oLayout1 = new sap.ui.layout.form.ResponsiveGridLayout("L1");
var oLayout2 = new sap.ui.layout.form.ResponsiveGridLayout("L2");
var selectedTableEntry='';
var formMode='';
var currentStatus;
var firstNotification="";
var EmployeeID = localStorage.getItem("EmployeeID")
var detailFooter = new sap.m.Bar({
		id: 'detailFooter',
		contentRight : [
						
						]
		
	})

var standardList  = new sap.m.List(
		  {
			  //items:standardListItem,
			  itemPress:[function(oEvt) {		  
				  buildDetailsContent(oEvt.getParameter("listItem").getId());
				 
				  oSplitApp.to("detail")}],
			  mode:sap.m.ListMode.SingleSelectMaster
		  });
	function handleChange(oEvent) {
		var oDRS = oEvent.oSource;
		var sFrom = oEvent.getParameter("from");
		var sTo = oEvent.getParameter("to");
		var bValid = oEvent.getParameter("valid");

		

		var oText = sap.ui.getCore().byId("TextEvent");
		//oText.setText("Event " + iEvent + "\nId: " + oEvent.oSource.getId() + "\nFrom: " + sFrom + "\nTo: " + sTo + "\nvalid: " + bValid);
		if (bValid) {
			oDRS.setValueState(sap.ui.core.ValueState.None);
		} else {
			oDRS.setValueState(sap.ui.core.ValueState.Error);
		}
		
		startDate=sFrom.getFullYear().toString()+zeroFill(sFrom.getMonth()+1)+zeroFill(sFrom.getDate())
		endDate=sTo.getFullYear().toString()+zeroFill(sTo.getMonth()+1)+zeroFill(sTo.getDate())
		
	};
	
var firstEntry="none:-1";
var formTaskStatus = new sap.m.Dialog("dlgTaskStatus",{
    title:"Task Status",
    modal: true,
    contentWidth:"1em",
    buttons: [
				new sap.m.Button( {
				    text: "Save",
				    type: 	sap.m.ButtonType.Accept,
				    tap: [ function(oEvt) {		  
						 
				    	formTaskStatus.close()
						  } ]
				}),
				new sap.m.Button( {
				    text: "Close",
				    type: 	sap.m.ButtonType.Reject,
				    tap: [ function(oEvt) {		  
						 
				    	formTaskStatus.close()
						  } ]
				})
				],	
//				  contentHeight:"50%",
				  contentWidth:"35%",
    content:[			
			new sap.ui.layout.form.Form("TaskStatusForm",{
			
				editable: true,
				layout: oLayout2,
				formContainers: [
					new sap.ui.layout.form.FormContainer("F0C1",{
						
						formElements: [
						               
							new sap.ui.layout.form.FormElement({
								title: "1",
								fields: [
								        new sap.m.CheckBox({}),
										new sap.m.Text({text: 'AB01 - Aborted Wrong Job Type'})
									]
								}),
							new sap.ui.layout.form.FormElement({
								title: "2",
								fields: [
								        new sap.m.CheckBox({}),
										new sap.m.Text({text: 'AB02 - Aborted Not Skilled'})
									]
								}),
							new sap.ui.layout.form.FormElement({
								title: "3",
								fields: [
								        new sap.m.CheckBox({}),
										new sap.m.Text({text: 'AB03 - Aborted Other'})
									]
								}),
							new sap.ui.layout.form.FormElement({
								title: "1",
								fields: [
								        new sap.m.CheckBox({}),
										new sap.m.Text({text: 'AB04 - Aborted Wrong Job Type'})
									]
								}),
							new sap.ui.layout.form.FormElement({
								title: "2",
								fields: [
								        new sap.m.CheckBox({}),
										new sap.m.Text({text: 'AB05 - Aborted Not Skilled'})
									]
								}),
							new sap.ui.layout.form.FormElement({
								title: "3",
								fields: [
								        new sap.m.CheckBox({}),
										new sap.m.Text({text: 'AB06 - Aborted Other'})
									]
								})
							
							]
						})
						
						]
			 	})

            ],
            beforeOpen:function(){
            }
 })
var formTask = new sap.m.Dialog("dlgTask",{
    title:"",
    modal: true,
    contentWidth:"1em",
    buttons: [
					new sap.m.Button( {
					    text: "Save",
					    tap: [ function(oEvt) {		  
									formTask.close()
							  } ]
					   
					}),   
					new sap.m.Button( {
					    text: "Cancel",
					    tap: [ function(oEvt) {		  						 
					    	formTask.close()} ]   
					})
					],	
		            contentWidth:"90%",
		            
		            	
    content:[


new sap.ui.layout.form.Form("TaskForm",{
	//title: new sap.ui.core.Title({text: "Address Data", icon: "../../commons/demokit/images/address.gif", tooltip: "Title tooltip"}),
	title: "",
	editable: false,
	layout: oLayout1,
	formContainers: [
		new sap.ui.layout.form.FormContainer("F1C1",{
			title: "",
			formElements: [
				new sap.ui.layout.form.FormElement({
					label: "Catalogue Type",
					fields: [
					         new sap.m.Input("TaskCatType",{})
						]
					}),
				new sap.ui.layout.form.FormElement({
					label: "Group",
					fields: [
					         new sap.m.Input("TaskGroup",{})
						]
					}),
				new sap.ui.layout.form.FormElement({
					label: "Code",
					fields: [
					         new sap.m.Input("TaskCode",{})
						]
					}),
				new sap.ui.layout.form.FormElement({
					label: "Text",
					fields: [
					         new sap.m.Input("TaskText",{})
						]
					})
				]
		}),
		new sap.ui.layout.form.FormContainer("F1C2",{
			title: "",
			formElements: [
				new sap.ui.layout.form.FormElement({
					label: "SLA End Date",
					fields: [
							new sap.m.Input("TaskSLAEnd",{})
							]
					}),
				new sap.ui.layout.form.FormElement({
					label: "Planned Start Date",
					fields: [
							new sap.m.Input("TaskPlannedStart",{})
							]
					}),
				new sap.ui.layout.form.FormElement({
					label: "Planned End Date",
					fields: [
							new sap.m.Input("TaskPlannedEnd",{})
							]
					})
				]
		}),
		new sap.ui.layout.form.FormContainer("F1C3",{
			title: "",

			formElements: [
				new sap.ui.layout.form.FormElement({
					label: "Status",
					fields: [
					        new sap.m.Input("TaskStatus",{}),
					        new sap.m.Button( {
							    text: "Change",
							    tap: [ function(oEvt) {		  
											formTaskStatus.open()
									  } ]
							   
							})
							]
					}),

				new sap.ui.layout.form.FormElement({
					label: "Complete",
					fields: [
							new sap.m.Switch({state: false,type: sap.m.SwitchType.AcceptReject})
							]
					})
				]
			}),
			new sap.ui.layout.form.FormContainer("F1C4",{
				title: "",

				formElements: [

					new sap.ui.layout.form.FormElement({
						label: "Long Text",
						fields: [
								new sap.m.TextArea("TaskLongText",{})
								]
						})
					]
				})
	]
})
             


            ],
            beforeOpen:function(){
            	var x =selectedTableEntry.split(":")
            	this.setTitle(formMode+" Task Details")
  				BuildTaskForm()
            	if(formMode=="Display"){
            		sap.ui.getCore().getElementById('TaskForm').setEditable(false)
            	}
            

            },
	 })
var formNewNotif = new sap.m.Dialog("dlgNewNotif",{
    title:"Create Notification",
    modal: true,
    contentWidth:"1em",
    buttons: [
					new sap.m.Button( {
					    text: "Save",
					    tap: [ function(oEvt) {		  
							/* createTimeConf(AbsenceType,startDate,endDate,
									sap.ui.getCore().byId("Days").getValue(),
									sap.ui.getCore().byId("Description").getValue(),
									sap.ui.getCore().byId("Comments").getValue());  */
									formNewNotif.close()
							  } ]
					   
					}),   
					new sap.m.Button( {
					    text: "Cancel",
					    tap: [ function(oEvt) {		  
							 
					    	formNewNotif.close()} ]   
					})
					],					
    content:[
 			new sap.ui.layout.form.SimpleForm({
				minWidth : 1024,
				maxContainerCols : 2,
				content : [
								
								
								new sap.m.Label({text:"Coding"}),
								new sap.m.Select('NewType',{
									
									items: [
										new sap.ui.core.Item({
											key: "1",
											text: "M1 Notification"
										}),

										new sap.ui.core.Item({
											key: "2",
											text: "M2 Notification"
										}),

										new sap.ui.core.Item({
											key: "3",
											text: "M3 - Notification"
										})
									],

									change: function(oControlEvent) {
										jQuery.sap.log.info("Event fired: 'change' value property to " + oControlEvent.getParameter("selectedItem") + " on " + this);
									}
								}),
								new sap.m.Select('NewSource',{
									
									items: [
										new sap.ui.core.Item({
											key: "1",
											text: "General"
										}),

										new sap.ui.core.Item({
											key: "2",
											text: "Hardware"
										}),

										new sap.ui.core.Item({
											key: "3",
											text: "Software"
										})
									],

									change: function(oControlEvent) {
										jQuery.sap.log.info("Event fired: 'change' value property to " + oControlEvent.getParameter("selectedItem") + " on " + this);
									}
								}),
								new sap.m.Select('Code',{
									
									items: [
										new sap.ui.core.Item({
											key: "1",
											text: "Code 1"
										}),

										new sap.ui.core.Item({
											key: "2",
											text: "Code 2"
										}),

										new sap.ui.core.Item({
											key: "3",
											text: "Code 3"
										})
									],

									change: function(oControlEvent) {
										jQuery.sap.log.info("Event fired: 'change' value property to " + oControlEvent.getParameter("selectedItem") + " on " + this);
									}
								}),
								
								new sap.m.Label({text:"Priority"}),
								new sap.m.Select('NewPriority',{
									
									items: [
										new sap.ui.core.Item({
											key: "1",
											text: "Red"
										}),

										new sap.ui.core.Item({
											key: "2",
											text: "Amber"
										}),

										new sap.ui.core.Item({
											key: "3",
											text: "Green"
										})
									],

									change: function(oControlEvent) {
										jQuery.sap.log.info("Event fired: 'change' value property to " + oControlEvent.getParameter("selectedItem") + " on " + this);
									}
								}),
								new sap.m.Label({text: "Start Date/Time:"}),
								
								new sap.m.DateTimeInput('NewNotifStart',{
									width : "99%",
									type : "DateTime",
									displayFormat : "yyyy/MM/dd hh:mm",
									dateValue : new Date()
								}),
								new sap.m.Label({text:"Description"}),
								new sap.m.Input("NewDescription",{ type: sap.m.InputType.Input}),
								
								new sap.m.Label({text:"Details"}),
								new sap.m.TextArea("NewDetails",{ rows: 3}),

			new sap.m.Label({text:"Functional Location"}),
			new sap.m.Input("NewFuncLoc",{ type: sap.m.InputType.Input}),
			
			new sap.m.Label({text:"Equipment"}),
			new sap.m.Input("NewEquipment",{ type: sap.m.InputType.Input}),								
				                  
							]
 					})

            ]
	 })
function buildNotifications(){
var item;	
var lStatus="";
var StatusState="";
var StatusIcon="";
	SQLStatement="SELECT * from MyNotifications"
html5sql.process(SQLStatement,
		 function(transaction, results, rowsArray){

			cnt = 0;
			while (cnt<rowsArray.length){

				item=rowsArray[cnt];
				if(cnt==0){
					firstNotification="notif:"+item.notifno
				}
				 
				standardList.addItem(
						  new sap.m.ObjectListItem("notif:"+item.notifno,
							  {
						  title:item.shorttext,
						  number:item.type, 
						  numberUnit:item.notifno,
						
						  type:sap.m.ListType.Active,
					
						  attributes: [
						                new sap.m.ObjectAttribute( {
						                    text: 'Start:'+formatDateTime1(item.startdate)
						                })
						                ],
						    firstStatus: [
						                new sap.m.ObjectStatus( {
						                    text: item.priority,
						                    state:"Success"
						                })
						                ]
					
							  })
						  );
					  cnt++;
			 }
			oMasterPage.destroyContent()
			oMasterPage.addContent(standardList);
			buildDetailsContent(firstNotification)
		 },
		 function(error, statement){
			 alert(error+statement)
		 }        
		);	
cnt = 0;




}
function buildDetails(){
	
		var objectHeader  = new sap.m.ObjectHeader('HEADER',
{
			
	title:"",
	number:'',
	numberUnit:'',
	attributes: [
	               	                new sap.m.ObjectAttribute('StartDate',{
	            	                   
	            	                }),

	            	                new sap.m.ObjectAttribute('ReportedOn',{
	            	                    
	            	                }),
	            	                new sap.m.ObjectAttribute('FuncLoc',{
	            	                    
	            	                }),
	            	                new sap.m.ObjectAttribute('Equipment',{
	            	                    
	            	                }),
	               	             ,
	            	                new sap.m.ObjectAttribute('Order',{
	            	                    
	            	                })
	               	                ],
	            	    firstStatus: [
	            	                new sap.m.ObjectStatus( 'State',{
	            	                  
	            	                   
	            	                })
	            	                ]

});


return objectHeader;

}

function BuildTaskForm(){

	var res = selectedTableEntry.split(":")

	
	SQLStatement="SELECT * from MyTasks where id = '"+res[1]+"'"

	html5sql.process(SQLStatement,
		 function(transaction, results, rowsArray){

			 if (rowsArray.length>0){
				 
				 
				 sap.ui.getCore().getElementById('TaskCatType').setValue(rowsArray[0].task_cat_typ)
				 sap.ui.getCore().getElementById('TaskGroup').setValue(rowsArray[0].task_codegrp+"-"+rowsArray[0].txt_taskgrp)
				 sap.ui.getCore().getElementById('TaskCode').setValue(rowsArray[0].task_code+"-"+rowsArray[0].txt_taskcd)
				 sap.ui.getCore().getElementById('TaskText').setValue(rowsArray[0].task_text)
				 sap.ui.getCore().getElementById('TaskSLAEnd').setValue(formatDateTime1(rowsArray[0].sla_end_date+" "+rowsArray[0].sla_end_time))
				 sap.ui.getCore().getElementById('TaskPlannedStart').setValue(formatDateTime1(rowsArray[0].plnd_start_date+" "+rowsArray[0].plnd_start_time))
				 sap.ui.getCore().getElementById('TaskPlannedEnd').setValue(formatDateTime1(rowsArray[0].plnd_end_date+" "+rowsArray[0].plnd_end_time))
				 sap.ui.getCore().getElementById('TaskStatus').setValue(rowsArray[0].status)
				 sap.ui.getCore().getElementById('TaskLongText').setValue(rowsArray[0].longtext)

				 
			 }
			
			
		 },
		 function(error, statement){
			 //outputLogToDB(); 
		 }        
		);	 

	 








	}

function buildDetailsContent(aid){

var res = aid.split(":")
var notifno=res[1];

var StatusState="";
var StatusIcon="";
SQLStatement="SELECT * from MyNotifications where notifno = '"+notifno+"'"

html5sql.process(SQLStatement,
	 function(transaction, results, rowsArray){

		 if (rowsArray.length>0){
			 
			 
			 sap.ui.getCore().getElementById('HEADER').setTitle(rowsArray[0].shorttext)
			 sap.ui.getCore().getElementById('HEADER').setNumber(rowsArray[0].notifno)
			 sap.ui.getCore().getElementById('HEADER').setNumberUnit(rowsArray[0].type)
			 sap.ui.getCore().getElementById('HEADER').destroyStatuses()
			 sap.ui.getCore().getElementById('HEADER').addStatus( new sap.m.ObjectStatus({
					text : rowsArray[0].priority,
					

					state : "Success"
			 }))
			
			  sap.ui.getCore().getElementById('StartDate').setTitle("Start Date")
			  sap.ui.getCore().getElementById('StartDate').setText(formatDateTime1(rowsArray[0].startdate))
			  sap.ui.getCore().getElementById('ReportedOn').setTitle("Reported On ")
			  sap.ui.getCore().getElementById('ReportedOn').setText(rowsArray[0].enddate)

			  sap.ui.getCore().getElementById('Order').setTitle("Order ")	
			  sap.ui.getCore().getElementById('Order').setText(rowsArray[0].orderno)	
			  sap.ui.getCore().getElementById('FuncLoc').setTitle("Funcloc ")	
			  sap.ui.getCore().getElementById('FuncLoc').setText(rowsArray[0].funcloc)	
			  sap.ui.getCore().getElementById('Equipment').setTitle("Equipment ")	
			  sap.ui.getCore().getElementById('Equipment').setText(rowsArray[0].equipment)	
			  sap.ui.getCore().getElementById('LongText').setText(rowsArray[0].longtext)	

			 
		 }
		
		 buildDetailsTabContent(notifno)
		 //outputLogToDB();	
	 },
	 function(error, statement){
		 //outputLogToDB(); 
	 }        
	);	

 








}

function buildDetailsTabs(){
	var tabBar  = new sap.m.IconTabBar('tabBar',
			{
				expanded:'{device>/isNoPhone}',

				select:[function(oEvt) {		  
					  if(oEvt.getParameters().key=="Activities"){oDetailPage.setFooter(detailFooter)}
					  if(oEvt.getParameters().key=="Items"){oDetailPage.setFooter(detailFooter)}
					  if(oEvt.getParameters().key=="LongText"){oDetailPage.setFooter(detailFooter)}
					  if(oEvt.getParameters().key=="Causes"){oDetailPage.setFooter(detailFooter)}
					 
					}
				],
				
				items: [
						new sap.m.IconTabFilter( 'LONGTEXT',{
						    key:'LongText',
						    tooltip: 'Long Text',
						    icon: "sap-icon://document-text",
						    content:[
										new sap.m.Text( 'LongText',{})
						             ]
						 }),
						 new sap.m.IconTabFilter( 'TASKS',{
	    	                   key:'Tasks',
	    	                   tooltip: 'Tasks',
	    	                   icon: "sap-icon://order-status",
	       	                   content:[
									new sap.m.Table("TasksTable",{
										mode: sap.m.ListMode.SingleSelectMaster,
										selectionChange: function(evt){
											selectedTableEntry=evt.getParameter("listItem").getId()
											formMode="Display"
											formTask.open()
									    },
										columns:[
										         new sap.m.Column({header: new sap.m.Label({text:"Id"}),
										        	 hAlign: 'Left',width: '10%', minScreenWidth : "" , demandPopin: false}),
										         new sap.m.Column({header: new sap.m.Label({text:"Group"}),
										        	 hAlign: 'Left',width: '20%',minScreenWidth : "" , demandPopin: false}),
										         new sap.m.Column({header: new sap.m.Label({text:"Code"}),
										        	 hAlign: 'Left',width: '20%', minScreenWidth : "" , demandPopin: false}),
										         new sap.m.Column({header: new sap.m.Label({text:"SLA End"}),
										        	 hAlign: 'Left',width: '12%', minScreenWidth : "" , demandPopin: true}),
											     new sap.m.Column({header: new sap.m.Label({text:"End Date"}),
											       	 hAlign: 'Left',width: '12%', minScreenWidth : "" , demandPopin: true}),
										         new sap.m.Column({header: new sap.m.Label({text:"Complete"}),
										        	 hAlign: 'Left',width: '14%',minScreenWidth : "" , demandPopin: true }) ,
										         new sap.m.Column({header: new sap.m.Label({text:"Del"}),
										        	 hAlign: 'Left',width: '12%',minScreenWidth : "" , demandPopin: true }) 
								           	     ]
									})
									]
					    }),     
     	               new sap.m.IconTabFilter( 'ACTIVITIES',{
    	                   key:'Activities',
    	                   tooltip: 'Activities',
    	                   icon: "sap-icon://activities",
       	                   content:[
								new sap.m.Table("ActivitiesTable",{
									mode: sap.m.ListMode.SingleSelectMaster,
									selectionChange: function(evt){
										selectedTableEntry=evt.getParameter("listItem").getId()
										formMode="Display"
										formActivity.open()
								    },
									columns:[
									         new sap.m.Column({header: new sap.m.Label({text:"Task"}),
									        	 hAlign: 'Left',width: '8%', minScreenWidth : "" , demandPopin: false}),
									         new sap.m.Column({header: new sap.m.Label({text:"Id"}),
									        	 hAlign: 'Left',width: '8%',minScreenWidth : "" , demandPopin: true}),
									         new sap.m.Column({header: new sap.m.Label({text:"Type"}),
									        	 hAlign: 'Left',width: '8%', minScreenWidth : "" , demandPopin: false}),
									         new sap.m.Column({header: new sap.m.Label({text:"Group"}),
									        	 hAlign: 'Left',width: '15%',minScreenWidth : "" , demandPopin: true}),
									         new sap.m.Column({header: new sap.m.Label({text:"Code"}),
									        	 hAlign: 'Left',width: '15%', minScreenWidth : "" , demandPopin: false}),
									         new sap.m.Column({header: new sap.m.Label({text:"Text"}),
									        	 hAlign: 'Left',width: '46%',minScreenWidth : "" , demandPopin: true })       	                         
							           	     ]
								})
								]
				    }),
       	                
       	                

           	                new sap.m.IconTabFilter( 'CAUSES',{
         	                   key:'Causes',
         	                  tooltip: 'Causes',
         	                  icon: "sap-icon://cause",
            	                   content:[
     									new sap.m.Table("CausesTable",{
     										width:'100%',
    										mode: sap.m.ListMode.SingleSelectMaster,
    										selectionChange: function(evt){
    											selectedTableEntry=evt.getParameter("listItem").getId()
    											formMode="Display"
    											formCause.open()
    									    },
     										columns:[
     										         
     										         
    										         new sap.m.Column({header: new sap.m.Label({text:"Item Id"}),
    										        	 hAlign: 'Left',width: '10%', minScreenWidth : "" , demandPopin: false}),
    										        	 new sap.m.Column({header: new sap.m.Label({text:"Id"}),
        										        	 hAlign: 'Left',width: '5%', minScreenWidth : "" , demandPopin: false}),
    										         new sap.m.Column({header: new sap.m.Label({text:"Group"}),
    										        	 hAlign: 'Left',width: '25%',minScreenWidth : "" , demandPopin: true}),
    										         new sap.m.Column({header: new sap.m.Label({text:"Code"}),
    										        	 hAlign: 'Left',width: '25%',minScreenWidth : "" , demandPopin: true }),     	                          
    										        	 new sap.m.Column({header: new sap.m.Label({text:"Description"}),
        										        	 hAlign: 'Left',width: '35%',minScreenWidth : "" , demandPopin: true }),                   
								           	     ]
     									})
     									]          	                
         	                }),			
           	                new sap.m.IconTabFilter( 'EFFECTS',{
          	                   key:'Effects',
          	                  tooltip: 'Effects',
          	                  icon: "sap-icon://list",
             	                   content:[
      									new sap.m.Table("EffectsTable",{
      										width:'100%',
    										mode: sap.m.ListMode.SingleSelectMaster,
    										selectionChange: function(evt){
    											selectedTableEntry=evt.getParameter("listItem").getId()
    											formMode="Display"
    											formEffect.open()
    									    },
      										columns:[
      										         
      										         
      										         new sap.m.Column({header: new sap.m.Label({text:"Item Id"}),
      										        	 hAlign: 'Left',width:'10%', minScreenWidth : "" , demandPopin: false}),
          										     new sap.m.Column({header: new sap.m.Label({text:"id"}),
          										         hAlign: 'Left',width:'5%', minScreenWidth : "" , demandPopin: false}),
              										 new sap.m.Column({header: new sap.m.Label({text:"Type"}),
      										        	 hAlign: 'Left',width:'10%', minScreenWidth : "" , demandPopin: false}),
              										 new sap.m.Column({header: new sap.m.Label({text:"Group"}),
      										        	 hAlign: 'Left',width:'20%', minScreenWidth : "" , demandPopin: true}),
              										 new sap.m.Column({header: new sap.m.Label({text:"Code"}),
      										        	 hAlign: 'Left',width:'20%', minScreenWidth : "" , demandPopin: true}),
 	 										         new sap.m.Column({header: new sap.m.Label({text:"Value"}),
 	 										        	 hAlign: 'Left',width:'35%', minScreenWidth : "small" , demandPopin: true}),                    
 								           	     ]
      									})
      									]          	                
          	                }),        	                
       	                ]


			})
	
	return tabBar;

	}

function deleteEntry(type){
	alert("Deleteing "+type)
}
function completeEntry(type){
	alert("Complete "+type)
}
function buildDetailsTabContent(notifNo){


html5sql.process("SELECT * FROM MyActivities where notifno = '"+notifNo+"' ;",
		 function(transaction, results, rowsArray){
			var n = 0;
			var opTable = sap.ui.getCore().getElementById('ActivitiesTable');
			opTable.destroyItems();
			while (n < rowsArray.length) {
				
		
				opTable.addItem (new sap.m.ColumnListItem({
					cells : 
						[
						new sap.m.Text({text: rowsArray[n].task_id}),
			            new sap.m.Text({text: rowsArray[n].item_id}),
						new sap.m.Text({text: rowsArray[n].act_cat_typ}),			    
						new sap.m.Text({text: rowsArray[n].txt_actgrp}),
			            new sap.m.Text({text: rowsArray[n].txt_actcd}),
						new sap.m.Text({text: rowsArray[n].act_text})   
				 		]
					}));
				n++;
			 }

		 },
		 function(error, statement){
			 //outputLogToDB(); 
		 }        
		);	
//Mpoints
html5sql.process("SELECT * FROM MyTasks where notifno = '"+notifNo+"' ;",
		 function(transaction, results, rowsArray){
			var n = 0;
			var opTable = sap.ui.getCore().getElementById('TasksTable');
			opTable.destroyItems();
			while (n < rowsArray.length) {

		         new sap.m.Column({header: new sap.m.Label({text:"SLA End"}),
		        	 hAlign: 'Left',width: '15%', minScreenWidth : "" , demandPopin: true}),
			     new sap.m.Column({header: new sap.m.Label({text:"End Date"}),
			       	 hAlign: 'Left',width: '15%', minScreenWidth : "" , demandPopin: true}),
		         new sap.m.Column({header: new sap.m.Label({text:"Time"}),
		        	 hAlign: 'Left',width: '10%',minScreenWidth : "" , demandPopin: true }),
		         new sap.m.Column({header: new sap.m.Label({text:"Complete"}),
		        	 hAlign: 'Left',width: '15%',minScreenWidth : "" , demandPopin: true }) 				
		
				opTable.addItem (new sap.m.ColumnListItem("Task:"+rowsArray[n].id,{
					cells : 
						[
						new sap.m.Text({text: rowsArray[n].item_id}),
			            new sap.m.Text({text: rowsArray[n].task_codegrp}),
						new sap.m.Text({text: rowsArray[n].task_code}),
						new sap.m.Text({text: formatDateTime(rowsArray[n].sla_end_date+rowsArray[n].sla_end_time)}),
						new sap.m.Text({text: formatDateTime(rowsArray[n].plnd_end_date+rowsArray[n].plnd_end_time)}),
						new sap.m.Button( {
			       			 
			       			 icon:"sap-icon://complete",
			       			
			       				 press: [ function(){
			       					completeEntry('Task');
			       				
			       						}]
			       			 }) ,
							new sap.m.Button( {
				       			 
				       			 icon:"sap-icon://delete",
				       			
				       				 press: [ function(){
				       					deleteEntry('Task');
				       				
				       						}]
				       			 })
				 		]
					}));
				n++;
			 }

		 },
		 function(error, statement){
			 //outputLogToDB(); 
		 }        
		);	

 //Time Confirmations
html5sql.process("SELECT * FROM MyCauses where notifno = '"+notifNo+"' ;",
		 function(transaction, results, rowsArray){

			var n = 0;
			var opTable = sap.ui.getCore().getElementById('CausesTable');
			opTable.destroyItems();
			while (n < rowsArray.length) {
				
		
				opTable.addItem (new sap.m.ColumnListItem({
					cells : 
						[
						new sap.m.Text({text: rowsArray[n].item_id}),
			            new sap.m.Text({text: rowsArray[n].cause_id}),
						new sap.m.Text({text: rowsArray[n].txt_causegrp}),
						new sap.m.Text({text: rowsArray[n].txt_causecd}),
			            new sap.m.Text({text: rowsArray[n].cause_text})  
				 		]
					}));
				n++;
			 }

		 },
		 function(error, statement){
			 //outputLogToDB(); 
		 }        
		);	
html5sql.process("SELECT * FROM MyEffects where notifno = '"+notifNo+"' ;",
		 function(transaction, results, rowsArray){
			var n = 0;
			var opTable = sap.ui.getCore().getElementById('EffectsTable');
			opTable.destroyItems();
			while (n < rowsArray.length) {
				
		
				opTable.addItem (new sap.m.ColumnListItem({
					cells : 
						[
						new sap.m.Text({text: rowsArray[n].item_id}),
			            new sap.m.Text({text: rowsArray[n].task_id}),
						new sap.m.Text({text: rowsArray[n].txt_effectgrp}),
						new sap.m.Text({text: rowsArray[n].txt_effectcd}),
			            new sap.m.Text({text: rowsArray[n].value})  
				 		]
					}));
				n++;
			 }

		 },
		 function(error, statement){
			 //outputLogToDB(); 
		 }        
		);	
}

function deleteAbsence()
{

deleteDBAbsence(currentAbsence)

}
	var oDetailPage = new sap.m.Page(
			"detail",
			{
				title : "Notiofication Details",
				content : [buildDetails(firstNotification),buildDetailsTabs()],
				showNavButton: true,
					 
					 navButtonPress: function() {				                  
						window.location.reload()
					 }
			}).addStyleClass("sapUiStdPage");


	//create first master page

	var oMasterPage = new sap.m.Page(
			"master",
			{
				 headerContent : new sap.m.Button({
                     icon: "sap-icon://home",
                     press : function() {
                    	 window.location.href="Home.html"
                     }
}),
				title : "Notifications",
				
				content : [ buildNotifications()],
				showNavButton: "{device>/isPhone}" ,
				footer  : new sap.m.Bar (
						{
							id : 'master-footer',

							contentLeft : [
									new sap.m.Button("Add1", {
					   					 text: "create",
					  					 press: [ function(){
					  						formNewNotif.open(); 
					  						
					  							}]
										 })
								]
						})			 

			});
	
	
	
	
	//create SplitApp()
	var oSplitApp = new sap.m.SplitApp({
		detailPages: [oDetailPage],
		masterPages: [oMasterPage],
		initialDetail: "detail",
		initialMaster: "master",
		afterMasterOpen: function(){
			jQuery.sap.log.info("master is opened");
		},
		afterMasterClose: function(){
			jQuery.sap.log.info("master is closed");
		}
	});

	if(jQuery.device.is.tablet || jQuery.device.is.desktop){
		oSplitApp.setDefaultTransitionNameDetail("fade");	
	}

	oSplitApp.placeAt("body");
</script>
</head>
<body id="body" class="sapUiBody">
</body>
</html>
